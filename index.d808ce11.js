const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.score=0,this.status="idle",this.initialState=t,this.state=this.copyState(this.initialState),this.lastNewTiles=[],this.lastMoves=[]}copyState(t){return t.map(t=>[...t])}addRandomTile(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);if(t.length>0){let e=Math.floor(Math.random()*t.length),[s,a]=t[e];return this.state[s][a]=.9>Math.random()?2:4,{row:s,col:a}}return null}moveLeft(){if("playing"===this.status&&this.move("left")){let t=this.addRandomTile();this.lastNewTiles=[t],this.checkGameState()}}moveRight(){if("playing"===this.status&&this.move("right")){let t=this.addRandomTile();this.lastNewTiles=[t],this.checkGameState()}}moveUp(){if("playing"===this.status&&this.move("up")){let t=this.addRandomTile();this.lastNewTiles=[t],this.checkGameState()}}moveDown(){if("playing"===this.status&&this.move("down")){let t=this.addRandomTile();this.lastNewTiles=[t],this.checkGameState()}}move(t){let e=this.copyState(this.state),s=t=>{let e=t.filter(t=>0!==t);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,e[t+1]=0,this.score+=e[t]);return e.filter(t=>0!==t)},a=t=>{let e=s(t);for(;e.length<4;)e.push(0);return e},i=t=>{let e=s([...t].reverse());for(;e.length<4;)e.push(0);return e.reverse()},l=t=>t.map(t=>a(t)),r=t=>t.map(t=>i(t));switch(t){case"left":this.state=l(this.state);break;case"right":this.state=r(this.state);break;case"up":this.state=this.transposeState(l(this.transposeState(this.state)));break;case"down":this.state=this.transposeState(r(this.transposeState(this.state)))}this.lastMoves=[];let o=new Map;for(let t=0;t<4;t++)for(let s=0;s<4;s++)if(0!==e[t][s]){let a=`${e[t][s]}_${t}_${s}`;o.set(a,{row:t,col:s})}for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0!==this.state[t][e])for(let[s,a]of o.entries()){let[i]=s.split("_");if(+i===this.state[t][e]){this.lastMoves.push({fromRow:a.row,fromCol:a.col,toRow:t,toCol:e,value:this.state[t][e]}),o.delete(s);break}}return!this.areStatesEqual(this.state,e)}checkGameState(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(2048===this.state[t][e]){this.status="win";return}this.hasEmptyCells()||this.canCombine()||(this.status="lose")}hasEmptyCells(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.state[t][e])return!0;return!1}canCombine(){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e];if(e<3&&s===this.state[t][e+1]||t<3&&s===this.state[t+1][e])return!0}return!1}transposeState(t){let e=[];for(let s=0;s<4;s++){e[s]=[];for(let a=0;a<4;a++)e[s].push(t[a][s])}return e}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){if("idle"===this.status){this.status="playing";let t=this.addRandomTile(),e=this.addRandomTile();this.lastNewTiles=[t,e]}}restart(){this.state=this.copyState(this.initialState),this.score=0,this.status="idle"}areStatesEqual(t,e){for(let s=0;s<4;s++)for(let a=0;a<4;a++)if(t[s][a]!==e[s][a])return!1;return!0}},e=document.querySelectorAll(".field-cell"),s=document.querySelector(".button.start");function a(){let s=0,a=t.getState(),i=t.lastNewTiles||[];for(let t=0;t<4;t++)for(let l=0;l<4;l++){let r=e[s];r.className="field-cell",r.style.transform="",a[t][l]?(r.textContent=a[t][l],r.classList.add(`field-cell--${a[t][l]}`),i.some(e=>e&&e.row===t&&e.col===l)&&(r.classList.add("new-tile"),r.addEventListener("animationend",()=>{r.classList.remove("new-tile")},{once:!0}))):r.textContent="",s++}document.querySelector(".game-score").textContent=t.getScore();let l=t.getStatus();"win"===l?document.querySelector(".message-win").classList.remove("hidden"):"lose"===l&&document.querySelector(".message-lose").classList.remove("hidden")}document.addEventListener("keydown",e=>{if("playing"!==t.getStatus())return;let s={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"}[e.key];if(s&&t.move(s)){let e=t.addRandomTile();t.lastNewTiles=[e],t.checkGameState(),a()}}),s.addEventListener("click",()=>{"button restart"===s.className&&t.restart(),t.start(),a(),document.querySelector(".message-win").classList.add("hidden"),document.querySelector(".message-lose").classList.add("hidden"),document.querySelector(".message-start").classList.add("hidden"),s.textContent="Restart",s.className="button restart"});
//# sourceMappingURL=index.d808ce11.js.map
